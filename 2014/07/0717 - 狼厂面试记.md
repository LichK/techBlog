##狼厂面试记

---------
下午两天去狼厂联盟前端技术部面试，狂虐两小时，虐了一些问题，回想起来，我TM其实知道了的啊！！！终于下定决心：
>写博客，多沉淀，no more 拖延！！

先把问题记录下，明天一一看来

- [maven的传递依赖](#q1)
- [zookeeper的实现原理与消息的同步方式](#q2)
- [工作中MyBatis遇见的坑](#q3)
- [DQC分布式事务中的坑](#q4)
- [Spring中的设计模式应用](#q5)
- [String类的底层实现](#q6)
- [Java基本数据类型中的坑](#q7)
- [迷宫最短路径算法](#q8)

### 1. maven的传递依赖
<span id="q1"></span>
问题一：

	项目A存在以下两种依赖
	A -> B -> C (v1.0)
	A -> C (v2.0)
	请问项目实际运行中会取得哪个版本的C？
	
问题二：

	项目A存在以下两种依赖
	A -> B -> C (v1.0)
	A -> D -> C (v2.0)
	请问项目实际运行中会取得哪个版本的C？
	
答：Maven传递依赖遵循`就近依赖`原则：

- 优先比较传递层级，层级越浅，则越优先
- 层级相同比较pom中出现顺序，谁先出现，则越优先

因此，针对问题一会依赖2.0的C，问题二会依赖1.0的C。

参考资料：[maven传递依赖的版本确定规则](http://blog.csdn.net/bluishglc/article/details/6584678)

### 2. zookeeper的实现原理与消息的同步方式
<span id="q2"></span>
Zookeeper广泛应用在分布式系统之中，其设计目的为了做到保证：

- 最终一致性：client不管连接到哪个server，展现的都是一份数据视图
- 可靠性：健壮，可靠，消息如果被一台server接受，那么将会被所有server接受
- 实时性：zookeeper保证client会在一个时间间隔内收到服务器更新或失效的信息，但因为网络延迟的存在，不保证多个client同时收到更新信息
- 等待无关：慢的或失效的client不得干预快速的client请求
- 原则性：任何数据更新操作只能成功或失败，不存在中间状态
- 顺序性：
	- 全局有序：如果消息a在消息b前发布，则所有server消息a都在消息b前发布，通过TCP协议保证先来先到
	- 因果顺序：如果消息a在消息b之前发生（a导致了b），并被一起发送，则a始终在b之前被执行，通过Leader保证因果顺序
	
为了满足以上目的，zookeeper使用了一致性协议[Zab(Zookeeper Atomic Broadcast)](http://blog.csdn.net/chen77716/article/details/7309915), Zab协议分两个工作阶段`Atomic Broadcast`和`Leader Election`。

**Atomic Broadcast原子广播：**

- 同一时刻存在一个Leader节点，其余为Follower
- 对于读请求，可以从client读取，如需**确保读取最新数据**，需从Leader读取
- 对于写请求，Leader直接执行或由Follower转发Leader执行

Zookeeper使用了一种简化版本的二阶段提交发送请求，但与二阶段提交有两个不同之处：
- 因为只有一个Leader，Leader提交到Follower的请求一定会被接受
- 不需要所有的Follower都响应成功，只要一个多数派即可

>两阶段提交，即使基于分布式系统架构下的所有节点在进行事务提交时保持一致性而设计的一种协议，分以下两阶段：

>	1. 提交请求阶段
>		- 协调者节点向所有参与者节点询问是否可以执行提交操作，并开始等待各参与者节点的响应。
>		- 参与者节点执行询问发起为止的所有事务操作，并将Undo信息和Redo信息写入日志。
>		- 各参与者节点响应协调者节点发起的询问。如果参与者节点的事务操作实际执行成功，则它返回一个“同意”消息；如果参与者节点的事务操作实际执行失败，则它返回一个“中止”消息。
>	2. 提交执行阶段
>		- 



**Leader选举**

	


### 3. 工作中MyBatis遇见的坑
<span id="q3"></span>

### 4. DQC分布式事务中的坑
<span id="q4"></span>

### 5. Spring中的设计模式应用
<span id="q5"></span>

### 6. String类的底层实现
<span id="q6"></span>

### 7. Java基本数据类型中的坑
<span id="q7"></span>

### 8. 迷宫最短路径算法
<span id="q8"></span>
	
	
